<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memorizuesi</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@800&family=Noto+Naskh+Arabic:wght@600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    
    <!-- Add to home screen meta tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="apple-touch-icon" href="icon.png"> <!-- Add your icon here -->
    <link rel="manifest" href="manifest.json"> <!-- Link to manifest file -->
</head>
<body>

    <h1 id="title">Memorizuesi</h1>
    <input type="text" id="textInput" placeholder="Shkruaj tekstin tënd këtu..." />
    <button id="FilloButton">Fillo</button>
    <div id="text"></div>
    <button id="revealButton" style="display: none;">Shfaq fjalën e rradhës</button>
    <button id="stopButton" style="display: none;">Ndalo memorizimin?</button> <!-- Initial text in Albanian -->
    
    <button id="languageToggle">Ndrysho gjuhën në Arabisht</button>
    <button id="moreButton" style="display: none;">A dëshironë të memorizoni më tepër?</button>

    <div id="history">
        <h2>Historia</h2>
        <ul id="historyList"></ul>
        <button id="clearHistoryButton">Fshi historinë</button>
    </div>

    <script>
        let currentWordIndex = 0;
        let words = [];
        const historyList = document.getElementById('historyList');
        const FilloButton = document.getElementById('FilloButton');
        const revealButton = document.getElementById('revealButton');
        const stopButton = document.getElementById('stopButton'); // Stop button reference
        const textDiv = document.getElementById('text');
        const textInput = document.getElementById('textInput');
        const languageToggle = document.getElementById('languageToggle');
        const moreButton = document.getElementById('moreButton');
        const clearHistoryButton = document.getElementById('clearHistoryButton');

        // Load history from localStorage on page load
        document.addEventListener('DOMContentLoaded', loadHistory);

        FilloButton.addEventListener('click', FilloMemorization);
        textInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                FilloMemorization();
            }
        });

        revealButton.addEventListener('click', revealNextWord);
        stopButton.addEventListener('click', stopMemorization); // Stop button click event
        document.addEventListener('keypress', (e) => {
            if (e.code === 'Space') {
                revealNextWord();
            } else if (e.code === 'Enter' && moreButton.style.display !== 'none') {
                moreButton.click();
            }
        });

        function FilloMemorization() {
            const text = textInput.value.trim();
            if (text) {
                words = text.split(' ');
                currentWordIndex = 0;
                textDiv.innerHTML = words.map(word => `<span style="display:none;">${word}</span>`).join(' ');
                textDiv.style.display = 'block';
                revealButton.style.display = 'inline-block'; // Show reveal button
                stopButton.style.display = 'inline-block'; // Show the Stop button
                FilloButton.style.display = 'none';
                textInput.value = ''; // Clear input after Filloing
                revealButton.disabled = false; // Enable the reveal button
                moreButton.style.display = 'none'; // Hide the "more" button initially
                
                // Set font for Arabic text
                setTextFont();
            } else {
                alert('Please enter some text.');
            }
        }

        function setTextFont() {
            const isArabic = /[\u0600-\u06FF]/.test(words.join(' ')); // Check if the input contains Arabic characters
            textDiv.style.fontFamily = isArabic ? '"Noto Naskh Arabic", sans-serif' : '"Poppins", sans-serif';
        }

        function revealNextWord() {
            if (currentWordIndex < words.length) {
                const wordSpans = textDiv.querySelectorAll('span');
                wordSpans[currentWordIndex].style.display = 'inline';
                currentWordIndex++;

                // Hide the reveal button and stop button if it's the last word
                if (currentWordIndex === words.length) {
                    revealButton.style.display = 'none'; // Hide reveal button
                    stopButton.style.display = 'none'; // Hide Stop button
                    moreButton.style.display = 'inline-block'; // Show "A dëshironë të memorizoni më tepër?" button
                }
            }
        }

        function stopMemorization() {
            const revealedWords = words.slice(0, currentWordIndex).join(' ');
            if (revealedWords) {
                saveToHistory(revealedWords); // Save revealed text to history
            }
            resetForNewText();
        }

        moreButton.addEventListener('click', () => {
            const completedText = words.join(' ');
            saveToHistory(completedText);
            resetForNewText();
        });

        function resetForNewText() {
            moreButton.style.display = 'none'; // Hide "more" button for new text
            FilloButton.style.display = 'inline-block'; // Show Fillo button for new text
            stopButton.style.display = 'none'; // Hide Stop button for new text
            revealButton.style.display = 'none'; // Hide Reveal button for new text
            textDiv.innerHTML = ''; // Clear previous text display
            currentWordIndex = 0; // Reset current word index
        }

        function saveToHistory(text) {
            const history = JSON.parse(localStorage.getItem('history')) || [];
            history.push(text);
            localStorage.setItem('history', JSON.stringify(history));
            loadHistory();
        }

        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('history')) || [];
            historyList.innerHTML = ''; // Clear existing history
            history.forEach((item, index) => {
                const historyItem = document.createElement('li');
                historyItem.textContent = `${index + 1}. ${item}`;
                historyList.appendChild(historyItem);
            });
        }

        clearHistoryButton.addEventListener('click', clearHistory);

        function clearHistory() {
            if (confirm('Are you sure you want to delete the history?')) {
                localStorage.removeItem('history'); // Clear the history from localStorage
                loadHistory(); // Refresh the displayed history
            }
        }

        languageToggle.addEventListener('click', () => {
            const isArabic = document.documentElement.lang === 'ar';
            document.documentElement.lang = isArabic ? 'en' : 'ar';
            document.getElementById('title').innerText = isArabic ? 'تذكر النص' : 'Memorizuesi';
            FilloButton.innerText = isArabic ? 'ابدأ' : 'Fillo';
            revealButton.innerText = isArabic ? 'كشف الكلمة التالية' : 'Shfaq fjalën e rradhës';
            textInput.placeholder = isArabic ? 'أدخل النص هنا...' : 'Shkruaj tekstin tënd këtu...';
            languageToggle.innerText = isArabic ? 'Ndrysho në Shqip' : 'Ndrysho gjuhën në Arabisht';

            // Update stop button text based on language
            stopButton.innerText = isArabic ? 'إيقاف التذكر؟' : 'Ndalo memorizimin?';

            // Update "more" button text based on language
            moreButton.innerText = isArabic ? 'هل تريد حفظ المزيد؟' : 'A dëshironë të memorizoni më tepër?';

            // Update history section text
            const historyTitle = isArabic ? 'التاريخ' : 'Historia';
            const clearHistoryText = isArabic ? 'حذف التاريخ' : 'Fshi historinë';
            document.querySelector('#history h2').innerText = historyTitle;
            clearHistoryButton.innerText = clearHistoryText;
        });
    </script>

</body>
</html>
